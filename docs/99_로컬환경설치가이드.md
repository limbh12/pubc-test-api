# 로컬 환경 설치 가이드

**PUBC Test API 프로젝트**

시스템에 설치된 JDK/JBoss와 충돌 없이 프로젝트 전용 환경을 구성하는 가이드입니다.

---

## 📋 목차

1. [개요](#개요)
2. [디렉토리 구조](#디렉토리-구조)
3. [설치 순서](#설치-순서)
4. [사용 방법](#사용-방법)
5. [문제 해결](#문제-해결)

---

## 개요

### 목적

- **독립성**: 시스템에 설치된 JDK/JBoss와 완전히 분리
- **일관성**: 모든 개발자가 동일한 환경에서 작업
- **이식성**: 프로젝트 디렉토리만 복사하면 즉시 사용 가능
- **버전 고정**: JDK 1.8과 JBoss EAP 7.4 고정

### 특징

✅ 프로젝트 디렉토리 내에 JDK와 JBoss 설치
✅ 시스템 환경 변수에 영향 없음
✅ 여러 프로젝트를 서로 다른 버전으로 운영 가능
✅ 자동 설치 스크립트 제공

---

## 디렉토리 구조

```
PubcTestApi/
├── bin/                          # 실행 스크립트
│   ├── setenv.sh                 # 환경 변수 설정
│   ├── jboss-start.sh            # JBoss Standalone 실행
│   ├── jboss-domain-start.sh     # JBoss Domain 실행
│   └── jboss-stop.sh             # JBoss 종료
├── scripts/                      # 설치 스크립트
│   ├── install-jdk.sh            # JDK 1.8 자동 설치
│   └── install-jboss.sh          # JBoss EAP 7.4 자동 설치
├── env/                          # 로컬 환경 (Git 제외)
│   ├── jdk/                      # JDK 1.8 설치 경로
│   │   └── zulu8.90.0.19-ca-jdk8.0.472-macosx_aarch64/  # Zulu JDK 홈
│   └── jboss/                    # JBoss 설치 경로
│       └── wildfly-26.1.3.Final/ # WildFly 홈 (또는 jboss-eap-7.4)
└── logs/                         # 애플리케이션 로그
```

---

## 설치 순서

### 1. JDK 1.8 설치

프로젝트 루트 디렉토리에서 실행:

```bash
./scripts/install-jdk.sh
```

**동작**:
- Azul Zulu OpenJDK 8.0.472 다운로드
- `env/jdk/` 경로에 압축 해제
- macOS (Intel/Apple Silicon), Linux 자동 감지

**설치되는 JDK**:
- **macOS Apple Silicon**: `zulu8.90.0.19-ca-jdk8.0.472-macosx_aarch64`
- **macOS Intel**: `zulu8.90.0.19-ca-jdk8.0.472-macosx_x64`
- **Linux**: `zulu8.90.0.19-ca-jdk8.0.472-linux_x64`

**결과 확인**:
```bash
ls -la env/jdk/
# zulu8.90.0.19-ca-jdk8.0.472-macosx_aarch64/ 디렉토리 확인

# 버전 확인
env/jdk/zulu8.90.0.19-ca-jdk8.0.472-macosx_aarch64/bin/java -version
# openjdk version "1.8.0_472"
# OpenJDK Runtime Environment (Zulu 8.90.0.19-CA-macos-aarch64)
```

### 2. JBoss EAP 7.4 설치

```bash
./scripts/install-jboss.sh
```

**설치 옵션**:

#### 옵션 1: WildFly 사용 (권장 - 무료)

```
어떤 방식을 선택하시겠습니까? (1: WildFly, 2: JBoss EAP 수동 다운로드): 1
```

- WildFly 26.x 자동 다운로드 및 설치
- JBoss EAP와 호환되는 커뮤니티 버전
- 개발/테스트 환경에 적합

#### 옵션 2: JBoss EAP 사용 (상용)

```
어떤 방식을 선택하시겠습니까? (1: WildFly, 2: JBoss EAP 수동 다운로드): 2
```

**수동 다운로드 필요**:

1. Red Hat 개발자 구독 가입 (무료):
   - https://developers.redhat.com/products/eap/download

2. JBoss EAP 7.4 ZIP 파일 다운로드

3. 다운로드한 파일을 `env/jboss/` 경로로 이동:
   ```bash
   mv ~/Downloads/jboss-eap-7.4.0.zip env/jboss/
   ```

4. 설치 스크립트 다시 실행:
   ```bash
   ./scripts/install-jboss.sh
   ```

**관리자 계정**:
- Username: `admin`
- Password: `admin123!`

**결과 확인**:
```bash
ls -la env/jboss/
# jboss-eap-7.4/ 또는 wildfly-26.x.x.Final/ 디렉토리 확인
```

---

## 사용 방법

### 환경 변수 설정

**매번 새로운 터미널을 열 때마다 실행**:

```bash
source bin/setenv.sh
```

**지원 쉘**:
- ✅ bash
- ✅ zsh

**설정 내용**:
- `JAVA_HOME`: 프로젝트 로컬 JDK 경로 (Zulu JDK 1.8)
- `JBOSS_HOME`: 프로젝트 로컬 JBoss 경로
- `PATH`: 로컬 JDK/JBoss bin 경로 추가 (최우선)
- `SYSTEM_JAVA_HOME`: 시스템 JDK 백업
- `SYSTEM_PATH`: 시스템 PATH 백업

**확인**:
```bash
echo $JAVA_HOME
# /path/to/PubcTestApi/env/jdk/zulu8.90.0.19-ca-jdk8.0.472-macosx_aarch64

echo $JBOSS_HOME
# /path/to/PubcTestApi/env/jboss/wildfly-26.1.3.Final

java -version
# openjdk version "1.8.0_472"
# OpenJDK Runtime Environment (Zulu 8.90.0.19-CA-macos-aarch64)
```

### JBoss 실행

#### Standalone 모드 (단일 서버)

```bash
./bin/jboss-start.sh
```

**접속 정보**:
- 애플리케이션: http://localhost:8080
- 관리 콘솔: http://localhost:9990

#### Domain 모드 (클러스터)

```bash
./bin/jboss-domain-start.sh
```

**접속 정보**:
- Domain 관리 콘솔: http://localhost:9990
- Host Controller: http://localhost:9999

#### 포트 변경

```bash
# 포트 오프셋 100 적용 (8080 → 8180)
PORT_OFFSET=100 ./bin/jboss-start.sh
```

### JBoss 종료

```bash
# Standalone 모드 종료
./bin/jboss-stop.sh standalone

# Domain 모드 종료
./bin/jboss-stop.sh domain
```

또는 실행 중인 터미널에서 `Ctrl+C`

---

## 고급 설정

### 환경 변수 커스터마이징

**bin/jboss-start.sh 실행 전 설정**:

```bash
# 바인드 주소 변경
export BIND_ADDRESS="192.168.1.100"

# 포트 오프셋
export PORT_OFFSET=100

# 서버 설정 파일 변경
export SERVER_CONFIG="standalone-full.xml"

# 실행
./bin/jboss-start.sh
```

### JVM 옵션 조정

**bin/setenv.sh 편집**:

```bash
# 메모리 증가
export JAVA_OPTS="-Xms2048m -Xmx4096m -XX:MetaspaceSize=512m -XX:MaxMetaspaceSize=1024m"
```

### 시스템 환경 복원

프로젝트 로컬 환경을 해제하고 시스템 환경으로 복원:

```bash
restore_system_env
```

**복원 내용**:
- `JAVA_HOME`: 시스템 JDK로 복원
- `PATH`: 시스템 PATH로 복원
- `JBOSS_HOME`: 제거
- `PROJECT_ROOT`: 제거

**사용 예시**:
```bash
# 프로젝트 환경 설정
source bin/setenv.sh
java -version
# openjdk version "1.8.0_472" (Zulu)

# 시스템 환경으로 복원
restore_system_env
java -version
# openjdk version "17.0.11" (시스템 JDK)
```

---

## 문제 해결

### JDK 설치 실패

**증상**: `install-jdk.sh` 실행 시 다운로드 오류

**해결**:
```bash
# curl 또는 wget 설치 확인
which curl
which wget

# macOS
brew install curl

# Linux (Ubuntu/Debian)
sudo apt-get install curl
```

### JBoss 실행 오류: JAVA_HOME not found

**증상**: `setenv.sh`를 실행했지만 JAVA_HOME이 설정되지 않음

**해결**:
```bash
# 환경 변수가 현재 쉘에 적용되도록 source 사용
source bin/setenv.sh

# 또는
. bin/setenv.sh
```

**잘못된 사용**:
```bash
# ❌ source 없이 실행하면 환경 변수가 적용되지 않음
./bin/setenv.sh
```

### 포트 충돌

**증상**: `Address already in use` 오류

**해결 1**: 다른 포트로 실행
```bash
PORT_OFFSET=100 ./bin/jboss-start.sh
# 8080 → 8180
# 9990 → 10090
```

**해결 2**: 기존 프로세스 종료
```bash
# 8080 포트 사용 프로세스 찾기
lsof -i :8080

# 프로세스 종료
kill -9 <PID>
```

### JDK 버전 충돌

**증상**: 시스템 JDK가 사용됨

**확인**:
```bash
which java
# /path/to/PubcTestApi/env/jdk/zulu8.90.0.19-ca-jdk8.0.472-macosx_aarch64/bin/java 여야 함

echo $JAVA_HOME
# /path/to/PubcTestApi/env/jdk/zulu8.90.0.19-ca-jdk8.0.472-macosx_aarch64 여야 함
```

**해결**:
```bash
# setenv.sh 다시 실행
source bin/setenv.sh

# PATH 순서 확인
echo $PATH | tr ':' '\n' | head -5
# 프로젝트 JDK bin이 최상단에 있어야 함
```

### WildFly vs JBoss EAP 차이

**WildFly**:
- ✅ 무료 오픈소스
- ✅ 자동 다운로드 가능
- ✅ 개발/테스트 환경에 적합
- ⚠️ 상용 지원 없음

**JBoss EAP**:
- ✅ Red Hat 상용 지원
- ✅ 프로덕션 환경 권장
- ⚠️ 수동 다운로드 필요
- ⚠️ 개발자 구독 필요 (무료 또는 유료)

**개발 단계**: WildFly 사용 권장
**프로덕션**: JBoss EAP 사용 권장

---

## 자주 묻는 질문

### Q1. 로컬 환경을 Git에 커밋해야 하나요?

**A**: 아니요. `env/` 디렉토리는 `.gitignore`에 등록되어 있습니다.

- ✅ 설치 스크립트만 Git에 포함
- ❌ JDK/JBoss 바이너리는 제외
- 각 개발자가 로컬에서 설치

### Q2. 여러 프로젝트를 동시에 실행할 수 있나요?

**A**: 네, 각 프로젝트는 독립적인 환경을 가집니다.

```bash
# 프로젝트 A
cd ProjectA
source bin/setenv.sh
./bin/jboss-start.sh

# 다른 터미널에서 프로젝트 B
cd ProjectB
source bin/setenv.sh
PORT_OFFSET=100 ./bin/jboss-start.sh
```

### Q3. macOS Apple Silicon (M1/M2/M3/M4)에서 작동하나요?

**A**: 네, 자동으로 ARM64 최적화 JDK를 다운로드합니다.

```bash
./scripts/install-jdk.sh
# Apple Silicon (M1/M2) 감지
# 운영체제: macos
# 아키텍처: aarch64
# JDK ARM64 버전 다운로드: zulu8.90.0.19-ca-jdk8.0.472-macosx_aarch64
```

**Intel Mac에서는**:
- 자동으로 x64 버전 다운로드
- `zulu8.90.0.19-ca-jdk8.0.472-macosx_x64`

### Q4. 설치된 환경을 다른 PC로 옮길 수 있나요?

**A**: 이론적으로 가능하지만 권장하지 않습니다.

- ✅ 권장: 새 PC에서 설치 스크립트 실행
- ⚠️ 비권장: `env/` 디렉토리 복사 (경로 의존성 문제)

### Q5. 시스템 JDK를 계속 사용하고 싶어요

**A**: `setenv.sh`를 실행하지 않으면 됩니다.

```bash
# 시스템 환경 사용
java -version  # 시스템 JDK

# 프로젝트 환경 사용
source bin/setenv.sh
java -version  # 프로젝트 로컬 JDK 1.8

# 다시 시스템 환경으로 복원
restore_system_env
```

---

## 정리

### 설치 요약

```bash
# 1. JDK 설치
./scripts/install-jdk.sh

# 2. JBoss 설치
./scripts/install-jboss.sh

# 3. 환경 변수 설정
source bin/setenv.sh

# 4. JBoss 실행
./bin/jboss-start.sh
```

### 일상 작업 흐름

```bash
# 1. 터미널 열기
cd /path/to/PubcTestApi

# 2. 환경 변수 로드
source bin/setenv.sh

# 3. 개발 작업
# - 코드 작성
# - 빌드: mvn clean package
# - 배포: cp target/*.war $JBOSS_HOME/standalone/deployments/

# 4. JBoss 실행
./bin/jboss-start.sh

# 5. 테스트
# http://localhost:8080/pubc-test-api

# 6. 종료
./bin/jboss-stop.sh
```

---

## 참고 자료

- **Azul Zulu OpenJDK**: https://www.azul.com/downloads/
- **Adoptium Eclipse Temurin**: https://adoptium.net/ (이전 버전)
- **WildFly**: https://www.wildfly.org/
- **JBoss EAP**: https://developers.redhat.com/products/eap
- **프로젝트 문서**: [README.md](../README.md)

---

**작성일**: 2025-11-06  
**최종 수정**: 2025-11-13  
**버전**: 1.1  
**작성자**: Claude Code
