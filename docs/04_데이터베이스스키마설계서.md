# 데이터베이스 스키마 설계서
## PUBC 연동 테스트 프로젝트

**작성일**: 2025-11-03
**프로젝트명**: PUBC-Test-API
**버전**: 2.0 (JDK 1.8)

> **📌 참고**: 데이터베이스 스키마는 Java/Spring 버전과 무관하게 동일합니다.
> 프로젝트 기술 스택은 **[JDK 1.8](./00_기술스택_JDK18.md)** 기준입니다.

---

## 목차

1. [데이터베이스 개요](#1-데이터베이스-개요)
2. [ERD (Entity Relationship Diagram)](#2-erd-entity-relationship-diagram)
3. [테이블 상세 설계](#3-테이블-상세-설계)
4. [PUBC 모듈 테이블](#4-pubc-모듈-테이블)
5. [초기 데이터 (Seed Data)](#5-초기-데이터-seed-data)
6. [인덱스 설계](#6-인덱스-설계)
7. [DDL 스크립트](#7-ddl-스크립트)

---

## 1. 데이터베이스 개요

### 1.1 데이터베이스 구조

이 프로젝트는 두 가지 데이터베이스 영역으로 구성됩니다:

1. **Application DB**: 비즈니스 도메인 데이터 (공공 문화시설 정보)
2. **PUBC DB**: PUBC 모듈 데이터 (인증, 로깅)

```
┌─────────────────────────────────────┐
│       Application Database          │
│  ┌───────────────────────────────┐  │
│  │ TB_CULTURE_FACILITY           │  │
│  │ (문화시설 정보)                │  │
│  │  - 공공데이터 조회 전용        │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│          PUBC Database              │
│  ┌───────────────────────────────┐  │
│  │ TN_PUBC_USER_CRTFC            │  │
│  │ (서비스키 인증 정보)           │  │
│  ├───────────────────────────────┤  │
│  │ TN_PUBC_USE_STTUS_INFO        │  │
│  │ (API 사용 현황 로깅)           │  │
│  ├───────────────────────────────┤  │
│  │ 기타 PUBC 테이블들...         │  │
│  └───────────────────────────────┘  │
└─────────────────────────────────────┘
```

### 1.2 지원 DBMS

- **개발/테스트**: H2 Database 1.4.x (인메모리/파일 모드)
- **운영**: Oracle, PostgreSQL, MySQL, Tibero, CUBRID, Sybase 등

> **📌 PUBC 모듈 지원**: PUBC는 11종 DBMS를 지원합니다 (Oracle, Sybase, PostgreSQL, MySQL, Tibero, CUBRID, MS SQL Server, Informix, Altibase, UniSQL, 공통 SQL).

### 1.3 명명 규칙

- **테이블명**: 대문자, 언더스코어 구분 (예: `TB_USER`)
- **컬럼명**: 대문자, 언더스코어 구분 (예: `USER_ID`)
- **기본키**: `PK_{테이블명}`
- **외래키**: `FK_{테이블명}_{참조테이블명}`
- **인덱스**: `IDX_{테이블명}_{컬럼명}`

### 1.4 공통 컬럼

모든 테이블은 다음 공통 컬럼을 포함합니다:

| 컬럼명 | 타입 | NULL | 설명 |
|--------|------|------|------|
| CREATE_DATE | TIMESTAMP | NOT NULL | 생성일시 |
| UPDATE_DATE | TIMESTAMP | NOT NULL | 수정일시 |

---

## 2. ERD (Entity Relationship Diagram)

### 2.1 Application Domain ERD

```
┌──────────────────────────────────────┐
│      TB_CULTURE_FACILITY             │
├──────────────────────────────────────┤
│ FACILITY_ID      VARCHAR(20)    PK   │
│ FACILITY_NAME    VARCHAR(100)        │
│ FACILITY_TYPE    VARCHAR(50)         │
│ ADDRESS          VARCHAR(200)        │
│ PHONE            VARCHAR(20)         │
│ LATITUDE         DECIMAL(10,7)       │
│ LONGITUDE        DECIMAL(10,7)       │
│ OPEN_TIME        VARCHAR(100)        │
│ HOMEPAGE         VARCHAR(200)        │
│ REGION_CODE      VARCHAR(2)          │
│ MANAGE_AGENCY    VARCHAR(100)        │
│ UPDATE_DATE      TIMESTAMP           │
└──────────────────────────────────────┘
```

### 2.2 PUBC Integration ERD

```
┌─────────────────────────────────────┐
│      TN_PUBC_USER_CRTFC            │
├─────────────────────────────────────┤
│ SERVICE_KEY    VARCHAR(50)    PK   │
│ SERVICE_ID     VARCHAR(50)         │
│ INST_CD        VARCHAR(20)         │
│ IP_ADRES       VARCHAR(200)        │
│ USE_BEGIN_DT   VARCHAR(8)          │
│ USE_END_DT     VARCHAR(8)          │
│ REGIST_DT      VARCHAR(14)         │
│ ...                                │
└─────────────────────────────────────┘
              │
              │ 1:N (서비스키별 다중 호출)
              ↓
┌─────────────────────────────────────┐
│    TN_PUBC_USE_STTUS_INFO          │
├─────────────────────────────────────┤
│ USE_STTUS_SN   NUMBER         PK   │
│ SERVICE_KEY    VARCHAR(50)    FK   │
│ SERVICE_ID     VARCHAR(50)         │
│ REQUEST_TIME   TIMESTAMP           │
│ TROBL_TY_CODE  VARCHAR(2)          │
│ TROBL_CN       VARCHAR(500)        │
│ CLIENT_IP      VARCHAR(50)         │
│ ...                                │
└─────────────────────────────────────┘
```

---

## 3. 테이블 상세 설계

### 3.1 TB_CULTURE_FACILITY (문화시설 정보)

**용도**: 공공 문화시설 정보 저장 (조회 전용 데이터)

#### 테이블 구조

| 컬럼명 | 데이터 타입 | NULL | 기본값 | 설명 |
|--------|------------|------|--------|------|
| FACILITY_ID | VARCHAR(20) | NOT NULL | - | 시설 ID (기본키) |
| FACILITY_NAME | VARCHAR(100) | NOT NULL | - | 시설명 |
| FACILITY_TYPE | VARCHAR(50) | NOT NULL | - | 시설 유형 (박물관, 미술관, 도서관 등) |
| ADDRESS | VARCHAR(200) | NOT NULL | - | 주소 |
| PHONE | VARCHAR(20) | NULL | - | 전화번호 |
| LATITUDE | DECIMAL(10,7) | NULL | - | 위도 (소수점 7자리) |
| LONGITUDE | DECIMAL(10,7) | NULL | - | 경도 (소수점 7자리) |
| OPEN_TIME | VARCHAR(100) | NULL | - | 운영시간 |
| HOMEPAGE | VARCHAR(200) | NULL | - | 홈페이지 URL |
| REGION_CODE | VARCHAR(2) | NOT NULL | - | 지역코드 (11:서울, 26:부산 등) |
| MANAGE_AGENCY | VARCHAR(100) | NULL | - | 관리기관명 |
| UPDATE_DATE | TIMESTAMP | NOT NULL | CURRENT_TIMESTAMP | 정보 수정일시 |

#### 제약조건

```sql
PRIMARY KEY (FACILITY_ID)
CHECK (LENGTH(FACILITY_ID) >= 4)
CHECK (REGION_CODE IN ('11','26','27','28','29','30','31','36','41','42','43','44','45','46','47','48','50'))
```

#### 인덱스

| 인덱스명 | 컬럼 | 타입 | 설명 |
|---------|------|------|------|
| PK_TB_CULTURE_FACILITY | FACILITY_ID | PRIMARY | 기본키 인덱스 |
| IDX_FACILITY_TYPE | FACILITY_TYPE | INDEX | 시설 유형별 검색 |
| IDX_FACILITY_REGION | REGION_CODE | INDEX | 지역별 검색 |
| IDX_FACILITY_NAME | FACILITY_NAME | INDEX | 시설명 검색 (LIKE) |
| IDX_FACILITY_TYPE_REGION | FACILITY_TYPE, REGION_CODE | INDEX | 복합 검색 최적화 |
| IDX_FACILITY_UPDATE | UPDATE_DATE | INDEX | 최신 정보 조회 |

#### 컬럼 상세 설명

**FACILITY_ID**:
- 시설 고유 식별자
- 형식: F + 숫자 (예: F001, F002)
- 최소 4자, 최대 20자
- 중복 불가 (기본키)

**FACILITY_NAME**:
- 시설의 공식 명칭
- 한글, 영문 허용
- 최대 100자
- 필수 입력

**FACILITY_TYPE**:
- 시설 유형 분류
- 값 예시: "박물관", "미술관", "도서관", "문화원", "공연장" 등
- 필수 입력

**ADDRESS**:
- 도로명 주소 또는 지번 주소
- 최대 200자
- 필수 입력

**PHONE**:
- 대표 전화번호
- 형식: 02-1234-5678 또는 010-1234-5678
- 선택 입력

**LATITUDE, LONGITUDE**:
- GPS 좌표 (지도 표시용)
- DECIMAL(10,7): 소수점 7자리 정밀도
- 예시: 위도 37.5240123, 경도 126.9803456
- 선택 입력

**OPEN_TIME**:
- 운영시간 및 휴무일 정보
- 예시: "10:00-18:00 (월요일 휴관)"
- 선택 입력

**HOMEPAGE**:
- 시설 홈페이지 URL
- 최대 200자
- 선택 입력

**REGION_CODE**:
- 행정구역 코드 (2자리)
- 11:서울, 26:부산, 27:대구, 28:인천, 29:광주, 30:대전, 31:울산, 36:세종
- 41:경기, 42:강원, 43:충북, 44:충남, 45:전북, 46:전남, 47:경북, 48:경남, 50:제주
- 필수 입력

**MANAGE_AGENCY**:
- 관리 기관명
- 예시: "문화체육관광부", "서울시청" 등
- 선택 입력

**UPDATE_DATE**:
- 정보 최종 수정일시
- 자동 생성/갱신
- TIMESTAMP 형식

---

## 4. PUBC 모듈 테이블

PUBC 모듈이 사용하는 주요 테이블들입니다. 이 테이블들은 PUBC 모듈의 DDL 스크립트를 통해 자동 생성됩니다.

### 4.1 TN_PUBC_USER_CRTFC (사용자 인증 정보)

**용도**: 서비스키별 인증 정보 및 권한 관리

#### 주요 컬럼

| 컬럼명 | 데이터 타입 | NULL | 설명 |
|--------|------------|------|------|
| SERVICE_KEY | VARCHAR(50) | NOT NULL | 서비스키 (기본키) |
| SERVICE_ID | VARCHAR(50) | NOT NULL | 서비스 ID |
| INST_CD | VARCHAR(20) | NULL | 기관 코드 |
| IP_ADRES | VARCHAR(200) | NULL | 허용 IP 주소 (콤마 구분) |
| USE_BEGIN_DT | VARCHAR(8) | NULL | 사용 시작일 (YYYYMMDD) |
| USE_END_DT | VARCHAR(8) | NULL | 사용 종료일 (YYYYMMDD) |
| USE_STTS | VARCHAR(1) | NULL | 사용 상태 (Y/N) |
| REGIST_DT | VARCHAR(14) | NULL | 등록일시 (YYYYMMDDHHmmss) |

#### 주요 기능

1. **서비스키 검증**: `SERVICE_KEY`로 조회
2. **IP 검증**: `IP_ADRES` 컬럼의 IP 리스트와 클라이언트 IP 비교
3. **사용 기간 검증**: `USE_BEGIN_DT` ~ `USE_END_DT` 범위 확인
4. **사용 상태 확인**: `USE_STTS = 'Y'` 여부

---

### 4.2 TN_PUBC_USE_STTUS_INFO (사용 현황 정보)

**용도**: 모든 API 호출 내역 로깅 (성공/실패 모두 기록)

#### 주요 컬럼

| 컬럼명 | 데이터 타입 | NULL | 설명 |
|--------|------------|------|------|
| USE_STTUS_SN | NUMBER(20) | NOT NULL | 일련번호 (기본키, 자동증가) |
| SERVICE_KEY | VARCHAR(50) | NULL | 서비스키 |
| SERVICE_ID | VARCHAR(50) | NULL | 서비스 ID |
| REQUEST_TIME | TIMESTAMP | NULL | 요청 일시 |
| TROBL_TY_CODE | VARCHAR(2) | NULL | 장애 유형 코드 (00: 정상) |
| TROBL_CN | VARCHAR(500) | NULL | 장애 내용 |
| CLIENT_IP | VARCHAR(50) | NULL | 클라이언트 IP |
| REQUEST_PARAM | CLOB | NULL | 요청 파라미터 (JSON 형식) |
| RESPONSE_CODE | VARCHAR(10) | NULL | 응답 코드 |
| PROCESS_TIME | NUMBER(10) | NULL | 처리 시간 (밀리초) |

#### 인덱스

| 인덱스명 | 컬럼 | 설명 |
|---------|------|------|
| PK_USE_STTUS_INFO | USE_STTUS_SN | 기본키 |
| IDX_USE_STTUS_KEY | SERVICE_KEY | 서비스키별 조회 |
| IDX_USE_STTUS_TIME | REQUEST_TIME | 시간별 조회 |
| IDX_USE_STTUS_CODE | TROBL_TY_CODE | 에러 통계 |

#### 로깅 시점

- **인증 실패 시**: 즉시 로깅 (troblTyCode != "00")
- **비즈니스 로직 성공 후**: finally 블록에서 로깅 (troblTyCode = "00")
- **예외 발생 시**: finally 블록에서 에러 정보와 함께 로깅

---

### 4.3 기타 PUBC 테이블 (참고)

PUBC 모듈은 추가로 다음 테이블들을 사용합니다 (본 프로젝트에서 직접 사용하지 않지만 PUBC 모듈 동작에 필요):

| 테이블명 | 용도 |
|---------|------|
| TN_PUBC_SERVICE_INFO | 서비스 메타데이터 |
| TN_PUBC_QTY_MNGMNT | 사용량 임계값 관리 |
| TN_PUBC_USE_RQST | 이용 신청 정보 |
| TN_PUBC_USE_LIMIT | 이용 제한 정보 |
| TN_PUBC_STATISTICS | 통계 정보 |

---

## 5. 초기 데이터 (Seed Data)

### 5.1 테스트용 문화시설 데이터

```sql
-- 서울지역 박물관/미술관
INSERT INTO TB_CULTURE_FACILITY (
    FACILITY_ID, FACILITY_NAME, FACILITY_TYPE, ADDRESS, PHONE,
    LATITUDE, LONGITUDE, OPEN_TIME, HOMEPAGE, REGION_CODE, MANAGE_AGENCY, UPDATE_DATE
) VALUES (
    'F001', '국립중앙박물관', '박물관', '서울특별시 용산구 서빙고로 137', '02-2077-9000',
    37.5240123, 126.9803456, '10:00-18:00 (월요일 휴관)', 'https://www.museum.go.kr',
    '11', '문화체육관광부', CURRENT_TIMESTAMP
);

INSERT INTO TB_CULTURE_FACILITY (
    FACILITY_ID, FACILITY_NAME, FACILITY_TYPE, ADDRESS, PHONE,
    LATITUDE, LONGITUDE, OPEN_TIME, HOMEPAGE, REGION_CODE, MANAGE_AGENCY, UPDATE_DATE
) VALUES (
    'F002', '국립현대미술관 서울관', '미술관', '서울특별시 종로구 삼청로 30', '02-3701-9500',
    37.5786789, 126.9811234, '10:00-18:00 (월요일 휴관)', 'https://www.mmca.go.kr',
    '11', '문화체육관광부', CURRENT_TIMESTAMP
);

INSERT INTO TB_CULTURE_FACILITY (
    FACILITY_ID, FACILITY_NAME, FACILITY_TYPE, ADDRESS, PHONE,
    LATITUDE, LONGITUDE, OPEN_TIME, HOMEPAGE, REGION_CODE, MANAGE_AGENCY, UPDATE_DATE
) VALUES (
    'F003', '서울시립미술관', '미술관', '서울특별시 중구 덕수궁길 61', '02-2124-8800',
    37.5654321, 126.9754321, '10:00-20:00 (월요일 휴관)', 'https://sema.seoul.go.kr',
    '11', '서울특별시', CURRENT_TIMESTAMP
);

-- 서울지역 도서관
INSERT INTO TB_CULTURE_FACILITY (
    FACILITY_ID, FACILITY_NAME, FACILITY_TYPE, ADDRESS, PHONE,
    LATITUDE, LONGITUDE, OPEN_TIME, HOMEPAGE, REGION_CODE, MANAGE_AGENCY, UPDATE_DATE
) VALUES (
    'F004', '국립중앙도서관', '도서관', '서울특별시 서초구 반포대로 201', '02-535-4142',
    37.5032123, 127.0375678, '09:00-18:00 (월요일 휴관)', 'https://www.nl.go.kr',
    '11', '문화체육관광부', CURRENT_TIMESTAMP
);

-- 부산지역 문화시설
INSERT INTO TB_CULTURE_FACILITY (
    FACILITY_ID, FACILITY_NAME, FACILITY_TYPE, ADDRESS, PHONE,
    LATITUDE, LONGITUDE, OPEN_TIME, HOMEPAGE, REGION_CODE, MANAGE_AGENCY, UPDATE_DATE
) VALUES (
    'F005', '부산시립미술관', '미술관', '부산광역시 해운대구 APEC로 58', '051-744-2602',
    35.1632100, 129.1313200, '10:00-18:00 (월요일 휴관)', 'https://art.busan.go.kr',
    '26', '부산광역시', CURRENT_TIMESTAMP
);

INSERT INTO TB_CULTURE_FACILITY (
    FACILITY_ID, FACILITY_NAME, FACILITY_TYPE, ADDRESS, PHONE,
    LATITUDE, LONGITUDE, OPEN_TIME, HOMEPAGE, REGION_CODE, MANAGE_AGENCY, UPDATE_DATE
) VALUES (
    'F006', '부산박물관', '박물관', '부산광역시 남구 유엔평화로 63', '051-610-7111',
    35.1362300, 129.0851200, '09:00-18:00 (월요일 휴관)', 'https://museum.busan.go.kr',
    '26', '부산광역시', CURRENT_TIMESTAMP
);

-- 경기도 문화시설
INSERT INTO TB_CULTURE_FACILITY (
    FACILITY_ID, FACILITY_NAME, FACILITY_TYPE, ADDRESS, PHONE,
    LATITUDE, LONGITUDE, OPEN_TIME, HOMEPAGE, REGION_CODE, MANAGE_AGENCY, UPDATE_DATE
) VALUES (
    'F007', '경기도박물관', '박물관', '경기도 용인시 기흥구 상갈로 6', '031-288-5300',
    37.2741100, 127.1134500, '10:00-18:00 (월요일 휴관)', 'https://museum.ggcf.kr',
    '41', '경기도', CURRENT_TIMESTAMP
);

INSERT INTO TB_CULTURE_FACILITY (
    FACILITY_ID, FACILITY_NAME, FACILITY_TYPE, ADDRESS, PHONE,
    LATITUDE, LONGITUDE, OPEN_TIME, HOMEPAGE, REGION_CODE, MANAGE_AGENCY, UPDATE_DATE
) VALUES (
    'F008', '경기도미술관', '미술관', '경기도 안산시 단원구 동산로 268', '031-481-7000',
    37.3125600, 126.8215400, '10:00-18:00 (월요일 휴관)', 'https://www.gmoma.ggcf.kr',
    '41', '경기도', CURRENT_TIMESTAMP
);
```

### 5.2 테스트용 서비스키

```sql
-- 테스트용 서비스키 (개발 환경)
INSERT INTO TN_PUBC_USER_CRTFC (
    SERVICE_KEY,
    SERVICE_ID,
    INST_CD,
    IP_ADRES,
    USE_BEGIN_DT,
    USE_END_DT,
    USE_STTS,
    REGIST_DT
) VALUES (
    'test123',                      -- 서비스키
    'TEST_USER_API',                -- 서비스 ID
    'TEST_INST',                    -- 기관 코드
    '127.0.0.1,localhost',          -- 허용 IP
    '20250101',                     -- 시작일
    '20991231',                     -- 종료일
    'Y',                            -- 사용 상태
    TO_CHAR(SYSDATE, 'YYYYMMDDHh24miss')  -- 등록일시
);

-- 운영 환경용 서비스키 (IP 제한)
INSERT INTO TN_PUBC_USER_CRTFC (
    SERVICE_KEY,
    SERVICE_ID,
    INST_CD,
    IP_ADRES,
    USE_BEGIN_DT,
    USE_END_DT,
    USE_STTS,
    REGIST_DT
) VALUES (
    'prod_key_abc123',
    'USER_API_PROD',
    'PROD_INST_001',
    '192.168.1.100,192.168.1.101',  -- 특정 IP만 허용
    '20250101',
    '20251231',
    'Y',
    TO_CHAR(SYSDATE, 'YYYYMMDDHh24miss')
);
```

---

## 6. 인덱스 설계

### 6.1 Application DB 인덱스

#### TB_CULTURE_FACILITY 인덱스 전략

```sql
-- 기본키 인덱스 (자동 생성)
-- PK_TB_CULTURE_FACILITY on FACILITY_ID

-- 시설 유형별 검색 인덱스
CREATE INDEX IDX_FACILITY_TYPE ON TB_CULTURE_FACILITY(FACILITY_TYPE);

-- 지역별 검색 인덱스
CREATE INDEX IDX_FACILITY_REGION ON TB_CULTURE_FACILITY(REGION_CODE);

-- 시설명 검색 인덱스 (LIKE 검색 지원)
CREATE INDEX IDX_FACILITY_NAME ON TB_CULTURE_FACILITY(FACILITY_NAME);

-- 복합 검색 최적화 (유형 + 지역)
CREATE INDEX IDX_FACILITY_TYPE_REGION ON TB_CULTURE_FACILITY(FACILITY_TYPE, REGION_CODE);

-- 최신 정보 조회
CREATE INDEX IDX_FACILITY_UPDATE ON TB_CULTURE_FACILITY(UPDATE_DATE DESC);
```

### 6.2 PUBC DB 인덱스

#### TN_PUBC_USE_STTUS_INFO 인덱스 전략

```sql
-- 복합 인덱스: 서비스키 + 요청시간 (통계 조회 최적화)
CREATE INDEX IDX_USE_STTUS_KEY_TIME
ON TN_PUBC_USE_STTUS_INFO(SERVICE_KEY, REQUEST_TIME DESC);

-- 에러 통계 인덱스
CREATE INDEX IDX_USE_STTUS_ERROR
ON TN_PUBC_USE_STTUS_INFO(TROBL_TY_CODE, REQUEST_TIME DESC)
WHERE TROBL_TY_CODE != '00';  -- 조건부 인덱스 (에러만)

-- 일별 통계 인덱스
CREATE INDEX IDX_USE_STTUS_DAILY
ON TN_PUBC_USE_STTUS_INFO(TRUNC(REQUEST_TIME), SERVICE_KEY);
```

---

## 7. DDL 스크립트

### 7.1 H2 Database (개발/테스트)

#### schema-h2.sql

```sql
-- ============================================
-- Application Database Schema (H2)
-- ============================================

-- TB_CULTURE_FACILITY 테이블 생성
DROP TABLE IF EXISTS TB_CULTURE_FACILITY CASCADE;

CREATE TABLE TB_CULTURE_FACILITY (
    FACILITY_ID      VARCHAR(20)    NOT NULL,
    FACILITY_NAME    VARCHAR(100)   NOT NULL,
    FACILITY_TYPE    VARCHAR(50)    NOT NULL,
    ADDRESS          VARCHAR(200)   NOT NULL,
    PHONE            VARCHAR(20),
    LATITUDE         DECIMAL(10,7),
    LONGITUDE        DECIMAL(10,7),
    OPEN_TIME        VARCHAR(100),
    HOMEPAGE         VARCHAR(200),
    REGION_CODE      VARCHAR(2)     NOT NULL,
    MANAGE_AGENCY    VARCHAR(100),
    UPDATE_DATE      TIMESTAMP      NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT PK_TB_CULTURE_FACILITY PRIMARY KEY (FACILITY_ID),
    CONSTRAINT CK_FACILITY_ID_LEN CHECK (LENGTH(FACILITY_ID) >= 4),
    CONSTRAINT CK_FACILITY_REGION CHECK (REGION_CODE IN ('11','26','27','28','29','30','31','36','41','42','43','44','45','46','47','48','50'))
);

-- 인덱스 생성
CREATE INDEX IDX_FACILITY_TYPE ON TB_CULTURE_FACILITY(FACILITY_TYPE);
CREATE INDEX IDX_FACILITY_REGION ON TB_CULTURE_FACILITY(REGION_CODE);
CREATE INDEX IDX_FACILITY_NAME ON TB_CULTURE_FACILITY(FACILITY_NAME);
CREATE INDEX IDX_FACILITY_TYPE_REGION ON TB_CULTURE_FACILITY(FACILITY_TYPE, REGION_CODE);
CREATE INDEX IDX_FACILITY_UPDATE ON TB_CULTURE_FACILITY(UPDATE_DATE DESC);

-- 테이블 코멘트
COMMENT ON TABLE TB_CULTURE_FACILITY IS '문화시설 정보';
COMMENT ON COLUMN TB_CULTURE_FACILITY.FACILITY_ID IS '시설 ID';
COMMENT ON COLUMN TB_CULTURE_FACILITY.FACILITY_NAME IS '시설명';
COMMENT ON COLUMN TB_CULTURE_FACILITY.FACILITY_TYPE IS '시설 유형';
COMMENT ON COLUMN TB_CULTURE_FACILITY.ADDRESS IS '주소';
COMMENT ON COLUMN TB_CULTURE_FACILITY.PHONE IS '전화번호';
COMMENT ON COLUMN TB_CULTURE_FACILITY.LATITUDE IS '위도';
COMMENT ON COLUMN TB_CULTURE_FACILITY.LONGITUDE IS '경도';
COMMENT ON COLUMN TB_CULTURE_FACILITY.OPEN_TIME IS '운영시간';
COMMENT ON COLUMN TB_CULTURE_FACILITY.HOMEPAGE IS '홈페이지';
COMMENT ON COLUMN TB_CULTURE_FACILITY.REGION_CODE IS '지역코드';
COMMENT ON COLUMN TB_CULTURE_FACILITY.MANAGE_AGENCY IS '관리기관명';
COMMENT ON COLUMN TB_CULTURE_FACILITY.UPDATE_DATE IS '정보 수정일시';

-- ============================================
-- PUBC Database Schema (H2)
-- 실제로는 PUBC 모듈 DDL 스크립트 사용
-- ============================================

-- TN_PUBC_USER_CRTFC 테이블 (간소화 버전)
DROP TABLE IF EXISTS TN_PUBC_USER_CRTFC CASCADE;

CREATE TABLE TN_PUBC_USER_CRTFC (
    SERVICE_KEY     VARCHAR(50)   NOT NULL,
    SERVICE_ID      VARCHAR(50)   NOT NULL,
    INST_CD         VARCHAR(20),
    IP_ADRES        VARCHAR(200),
    USE_BEGIN_DT    VARCHAR(8),
    USE_END_DT      VARCHAR(8),
    USE_STTS        VARCHAR(1)    DEFAULT 'Y',
    REGIST_DT       VARCHAR(14),
    CONSTRAINT PK_USER_CRTFC PRIMARY KEY (SERVICE_KEY)
);

-- TN_PUBC_USE_STTUS_INFO 테이블 (간소화 버전)
DROP TABLE IF EXISTS TN_PUBC_USE_STTUS_INFO CASCADE;
DROP SEQUENCE IF EXISTS SEQ_USE_STTUS_SN;

CREATE SEQUENCE SEQ_USE_STTUS_SN START WITH 1 INCREMENT BY 1;

CREATE TABLE TN_PUBC_USE_STTUS_INFO (
    USE_STTUS_SN    BIGINT        NOT NULL DEFAULT NEXT VALUE FOR SEQ_USE_STTUS_SN,
    SERVICE_KEY     VARCHAR(50),
    SERVICE_ID      VARCHAR(50),
    REQUEST_TIME    TIMESTAMP     DEFAULT CURRENT_TIMESTAMP,
    TROBL_TY_CODE   VARCHAR(2)    DEFAULT '00',
    TROBL_CN        VARCHAR(500),
    CLIENT_IP       VARCHAR(50),
    REQUEST_PARAM   CLOB,
    RESPONSE_CODE   VARCHAR(10),
    PROCESS_TIME    INT,
    CONSTRAINT PK_USE_STTUS_INFO PRIMARY KEY (USE_STTUS_SN)
);

-- 인덱스 생성
CREATE INDEX IDX_USE_STTUS_KEY ON TN_PUBC_USE_STTUS_INFO(SERVICE_KEY);
CREATE INDEX IDX_USE_STTUS_TIME ON TN_PUBC_USE_STTUS_INFO(REQUEST_TIME DESC);
CREATE INDEX IDX_USE_STTUS_CODE ON TN_PUBC_USE_STTUS_INFO(TROBL_TY_CODE);
```

---

### 7.2 Oracle Database (운영)

#### schema-oracle.sql

```sql
-- ============================================
-- Application Database Schema (Oracle)
-- ============================================

-- TB_CULTURE_FACILITY 테이블 생성
DROP TABLE TB_CULTURE_FACILITY CASCADE CONSTRAINTS;

CREATE TABLE TB_CULTURE_FACILITY (
    FACILITY_ID      VARCHAR2(20)    NOT NULL,
    FACILITY_NAME    VARCHAR2(100)   NOT NULL,
    FACILITY_TYPE    VARCHAR2(50)    NOT NULL,
    ADDRESS          VARCHAR2(200)   NOT NULL,
    PHONE            VARCHAR2(20),
    LATITUDE         NUMBER(10,7),
    LONGITUDE        NUMBER(10,7),
    OPEN_TIME        VARCHAR2(100),
    HOMEPAGE         VARCHAR2(200),
    REGION_CODE      VARCHAR2(2)     NOT NULL,
    MANAGE_AGENCY    VARCHAR2(100),
    UPDATE_DATE      TIMESTAMP       DEFAULT SYSTIMESTAMP NOT NULL,
    CONSTRAINT PK_TB_CULTURE_FACILITY PRIMARY KEY (FACILITY_ID),
    CONSTRAINT CK_FACILITY_ID_LEN CHECK (LENGTH(FACILITY_ID) >= 4),
    CONSTRAINT CK_FACILITY_REGION CHECK (REGION_CODE IN ('11','26','27','28','29','30','31','36','41','42','43','44','45','46','47','48','50'))
);

-- 인덱스 생성
CREATE INDEX IDX_FACILITY_TYPE ON TB_CULTURE_FACILITY(FACILITY_TYPE);
CREATE INDEX IDX_FACILITY_REGION ON TB_CULTURE_FACILITY(REGION_CODE);
CREATE INDEX IDX_FACILITY_NAME ON TB_CULTURE_FACILITY(FACILITY_NAME);
CREATE INDEX IDX_FACILITY_TYPE_REGION ON TB_CULTURE_FACILITY(FACILITY_TYPE, REGION_CODE);
CREATE INDEX IDX_FACILITY_UPDATE ON TB_CULTURE_FACILITY(UPDATE_DATE DESC);

-- 테이블 코멘트
COMMENT ON TABLE TB_CULTURE_FACILITY IS '문화시설 정보';
COMMENT ON COLUMN TB_CULTURE_FACILITY.FACILITY_ID IS '시설 ID';
COMMENT ON COLUMN TB_CULTURE_FACILITY.FACILITY_NAME IS '시설명';
COMMENT ON COLUMN TB_CULTURE_FACILITY.FACILITY_TYPE IS '시설 유형';
COMMENT ON COLUMN TB_CULTURE_FACILITY.ADDRESS IS '주소';
COMMENT ON COLUMN TB_CULTURE_FACILITY.PHONE IS '전화번호';
COMMENT ON COLUMN TB_CULTURE_FACILITY.LATITUDE IS '위도';
COMMENT ON COLUMN TB_CULTURE_FACILITY.LONGITUDE IS '경도';
COMMENT ON COLUMN TB_CULTURE_FACILITY.OPEN_TIME IS '운영시간';
COMMENT ON COLUMN TB_CULTURE_FACILITY.HOMEPAGE IS '홈페이지';
COMMENT ON COLUMN TB_CULTURE_FACILITY.REGION_CODE IS '지역코드';
COMMENT ON COLUMN TB_CULTURE_FACILITY.MANAGE_AGENCY IS '관리기관명';
COMMENT ON COLUMN TB_CULTURE_FACILITY.UPDATE_DATE IS '정보 수정일시';

-- UPDATE_DATE 자동 갱신 트리거
CREATE OR REPLACE TRIGGER TRG_FACILITY_UPD_DATE
BEFORE UPDATE ON TB_CULTURE_FACILITY
FOR EACH ROW
BEGIN
    :NEW.UPDATE_DATE := SYSTIMESTAMP;
END;
/

-- ============================================
-- PUBC Database Schema (Oracle)
-- 실제 환경에서는 PUBC 제공 DDL 사용
-- ============================================

-- TN_PUBC_USER_CRTFC 테이블
DROP TABLE TN_PUBC_USER_CRTFC CASCADE CONSTRAINTS;

CREATE TABLE TN_PUBC_USER_CRTFC (
    SERVICE_KEY     VARCHAR2(50)   NOT NULL,
    SERVICE_ID      VARCHAR2(50)   NOT NULL,
    INST_CD         VARCHAR2(20),
    IP_ADRES        VARCHAR2(200),
    USE_BEGIN_DT    VARCHAR2(8),
    USE_END_DT      VARCHAR2(8),
    USE_STTS        VARCHAR2(1)    DEFAULT 'Y',
    REGIST_DT       VARCHAR2(14),
    CONSTRAINT PK_USER_CRTFC PRIMARY KEY (SERVICE_KEY)
);

-- TN_PUBC_USE_STTUS_INFO 테이블
DROP TABLE TN_PUBC_USE_STTUS_INFO CASCADE CONSTRAINTS;
DROP SEQUENCE SEQ_USE_STTUS_SN;

CREATE SEQUENCE SEQ_USE_STTUS_SN
    START WITH 1
    INCREMENT BY 1
    NOCACHE
    NOCYCLE;

CREATE TABLE TN_PUBC_USE_STTUS_INFO (
    USE_STTUS_SN    NUMBER(20)       NOT NULL,
    SERVICE_KEY     VARCHAR2(50),
    SERVICE_ID      VARCHAR2(50),
    REQUEST_TIME    TIMESTAMP        DEFAULT SYSTIMESTAMP,
    TROBL_TY_CODE   VARCHAR2(2)      DEFAULT '00',
    TROBL_CN        VARCHAR2(500),
    CLIENT_IP       VARCHAR2(50),
    REQUEST_PARAM   CLOB,
    RESPONSE_CODE   VARCHAR2(10),
    PROCESS_TIME    NUMBER(10),
    CONSTRAINT PK_USE_STTUS_INFO PRIMARY KEY (USE_STTUS_SN)
);

-- 인덱스 생성
CREATE INDEX IDX_USE_STTUS_KEY ON TN_PUBC_USE_STTUS_INFO(SERVICE_KEY);
CREATE INDEX IDX_USE_STTUS_TIME ON TN_PUBC_USE_STTUS_INFO(REQUEST_TIME DESC);
CREATE INDEX IDX_USE_STTUS_CODE ON TN_PUBC_USE_STTUS_INFO(TROBL_TY_CODE);

-- 복합 인덱스 (통계 조회 최적화)
CREATE INDEX IDX_USE_STTUS_KEY_TIME
ON TN_PUBC_USE_STTUS_INFO(SERVICE_KEY, REQUEST_TIME DESC);

-- 파티셔닝 (선택사항 - 대용량 데이터)
-- PARTITION BY RANGE (REQUEST_TIME) INTERVAL (NUMTOYMINTERVAL(1, 'MONTH'))
```

---

### 7.3 PostgreSQL Database

#### schema-postgresql.sql

```sql
-- ============================================
-- Application Database Schema (PostgreSQL)
-- ============================================

-- TB_CULTURE_FACILITY 테이블 생성
DROP TABLE IF EXISTS TB_CULTURE_FACILITY CASCADE;

CREATE TABLE TB_CULTURE_FACILITY (
    FACILITY_ID      VARCHAR(20)    NOT NULL,
    FACILITY_NAME    VARCHAR(100)   NOT NULL,
    FACILITY_TYPE    VARCHAR(50)    NOT NULL,
    ADDRESS          VARCHAR(200)   NOT NULL,
    PHONE            VARCHAR(20),
    LATITUDE         DECIMAL(10,7),
    LONGITUDE        DECIMAL(10,7),
    OPEN_TIME        VARCHAR(100),
    HOMEPAGE         VARCHAR(200),
    REGION_CODE      VARCHAR(2)     NOT NULL,
    MANAGE_AGENCY    VARCHAR(100),
    UPDATE_DATE      TIMESTAMP      NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT PK_TB_CULTURE_FACILITY PRIMARY KEY (FACILITY_ID),
    CONSTRAINT CK_FACILITY_ID_LEN CHECK (LENGTH(FACILITY_ID) >= 4),
    CONSTRAINT CK_FACILITY_REGION CHECK (REGION_CODE IN ('11','26','27','28','29','30','31','36','41','42','43','44','45','46','47','48','50'))
);

-- 인덱스 생성
CREATE INDEX IDX_FACILITY_TYPE ON TB_CULTURE_FACILITY(FACILITY_TYPE);
CREATE INDEX IDX_FACILITY_REGION ON TB_CULTURE_FACILITY(REGION_CODE);
CREATE INDEX IDX_FACILITY_NAME ON TB_CULTURE_FACILITY(FACILITY_NAME);
CREATE INDEX IDX_FACILITY_TYPE_REGION ON TB_CULTURE_FACILITY(FACILITY_TYPE, REGION_CODE);
CREATE INDEX IDX_FACILITY_UPDATE ON TB_CULTURE_FACILITY(UPDATE_DATE DESC);

-- 테이블 코멘트
COMMENT ON TABLE TB_CULTURE_FACILITY IS '문화시설 정보';
COMMENT ON COLUMN TB_CULTURE_FACILITY.FACILITY_ID IS '시설 ID';
COMMENT ON COLUMN TB_CULTURE_FACILITY.FACILITY_NAME IS '시설명';
COMMENT ON COLUMN TB_CULTURE_FACILITY.FACILITY_TYPE IS '시설 유형';
COMMENT ON COLUMN TB_CULTURE_FACILITY.ADDRESS IS '주소';
COMMENT ON COLUMN TB_CULTURE_FACILITY.PHONE IS '전화번호';
COMMENT ON COLUMN TB_CULTURE_FACILITY.LATITUDE IS '위도';
COMMENT ON COLUMN TB_CULTURE_FACILITY.LONGITUDE IS '경도';
COMMENT ON COLUMN TB_CULTURE_FACILITY.OPEN_TIME IS '운영시간';
COMMENT ON COLUMN TB_CULTURE_FACILITY.HOMEPAGE IS '홈페이지';
COMMENT ON COLUMN TB_CULTURE_FACILITY.REGION_CODE IS '지역코드';
COMMENT ON COLUMN TB_CULTURE_FACILITY.MANAGE_AGENCY IS '관리기관명';
COMMENT ON COLUMN TB_CULTURE_FACILITY.UPDATE_DATE IS '정보 수정일시';

-- UPDATE_DATE 자동 갱신 함수 및 트리거
CREATE OR REPLACE FUNCTION update_facility_date()
RETURNS TRIGGER AS $$
BEGIN
    NEW.UPDATE_DATE = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_facility_upd_date
BEFORE UPDATE ON TB_CULTURE_FACILITY
FOR EACH ROW
EXECUTE FUNCTION update_facility_date();

-- ============================================
-- PUBC Database Schema (PostgreSQL)
-- ============================================

-- TN_PUBC_USER_CRTFC 테이블
DROP TABLE IF EXISTS TN_PUBC_USER_CRTFC CASCADE;

CREATE TABLE TN_PUBC_USER_CRTFC (
    SERVICE_KEY     VARCHAR(50)   NOT NULL,
    SERVICE_ID      VARCHAR(50)   NOT NULL,
    INST_CD         VARCHAR(20),
    IP_ADRES        VARCHAR(200),
    USE_BEGIN_DT    VARCHAR(8),
    USE_END_DT      VARCHAR(8),
    USE_STTS        VARCHAR(1)    DEFAULT 'Y',
    REGIST_DT       VARCHAR(14),
    CONSTRAINT PK_USER_CRTFC PRIMARY KEY (SERVICE_KEY)
);

-- TN_PUBC_USE_STTUS_INFO 테이블
DROP TABLE IF EXISTS TN_PUBC_USE_STTUS_INFO CASCADE;
DROP SEQUENCE IF EXISTS SEQ_USE_STTUS_SN;

CREATE SEQUENCE SEQ_USE_STTUS_SN START 1 INCREMENT 1;

CREATE TABLE TN_PUBC_USE_STTUS_INFO (
    USE_STTUS_SN    BIGINT        NOT NULL DEFAULT nextval('SEQ_USE_STTUS_SN'),
    SERVICE_KEY     VARCHAR(50),
    SERVICE_ID      VARCHAR(50),
    REQUEST_TIME    TIMESTAMP     DEFAULT CURRENT_TIMESTAMP,
    TROBL_TY_CODE   VARCHAR(2)    DEFAULT '00',
    TROBL_CN        VARCHAR(500),
    CLIENT_IP       VARCHAR(50),
    REQUEST_PARAM   TEXT,
    RESPONSE_CODE   VARCHAR(10),
    PROCESS_TIME    INTEGER,
    CONSTRAINT PK_USE_STTUS_INFO PRIMARY KEY (USE_STTUS_SN)
);

-- 인덱스 생성
CREATE INDEX IDX_USE_STTUS_KEY ON TN_PUBC_USE_STTUS_INFO(SERVICE_KEY);
CREATE INDEX IDX_USE_STTUS_TIME ON TN_PUBC_USE_STTUS_INFO(REQUEST_TIME DESC);
CREATE INDEX IDX_USE_STTUS_CODE ON TN_PUBC_USE_STTUS_INFO(TROBL_TY_CODE);
CREATE INDEX IDX_USE_STTUS_KEY_TIME ON TN_PUBC_USE_STTUS_INFO(SERVICE_KEY, REQUEST_TIME DESC);
```

---

### 7.4 초기 데이터 스크립트

#### data-seed.sql

```sql
-- ============================================
-- 초기 데이터 (모든 DBMS 공통)
-- ============================================

-- 테스트 문화시설 데이터 (샘플 8건)
INSERT INTO TB_CULTURE_FACILITY (FACILITY_ID, FACILITY_NAME, FACILITY_TYPE, ADDRESS, PHONE, LATITUDE, LONGITUDE, OPEN_TIME, HOMEPAGE, REGION_CODE, MANAGE_AGENCY)
VALUES ('F001', '국립중앙박물관', '박물관', '서울특별시 용산구 서빙고로 137', '02-2077-9000', 37.5240123, 126.9803456, '10:00-18:00 (월요일 휴관)', 'https://www.museum.go.kr', '11', '문화체육관광부');

INSERT INTO TB_CULTURE_FACILITY (FACILITY_ID, FACILITY_NAME, FACILITY_TYPE, ADDRESS, PHONE, LATITUDE, LONGITUDE, OPEN_TIME, HOMEPAGE, REGION_CODE, MANAGE_AGENCY)
VALUES ('F002', '국립현대미술관 서울관', '미술관', '서울특별시 종로구 삼청로 30', '02-3701-9500', 37.5786789, 126.9811234, '10:00-18:00 (월요일 휴관)', 'https://www.mmca.go.kr', '11', '문화체육관광부');

INSERT INTO TB_CULTURE_FACILITY (FACILITY_ID, FACILITY_NAME, FACILITY_TYPE, ADDRESS, PHONE, LATITUDE, LONGITUDE, OPEN_TIME, HOMEPAGE, REGION_CODE, MANAGE_AGENCY)
VALUES ('F003', '서울시립미술관', '미술관', '서울특별시 중구 덕수궁길 61', '02-2124-8800', 37.5654321, 126.9754321, '10:00-20:00 (월요일 휴관)', 'https://sema.seoul.go.kr', '11', '서울특별시');

INSERT INTO TB_CULTURE_FACILITY (FACILITY_ID, FACILITY_NAME, FACILITY_TYPE, ADDRESS, PHONE, LATITUDE, LONGITUDE, OPEN_TIME, HOMEPAGE, REGION_CODE, MANAGE_AGENCY)
VALUES ('F004', '국립중앙도서관', '도서관', '서울특별시 서초구 반포대로 201', '02-535-4142', 37.5032123, 127.0375678, '09:00-18:00 (월요일 휴관)', 'https://www.nl.go.kr', '11', '문화체육관광부');

INSERT INTO TB_CULTURE_FACILITY (FACILITY_ID, FACILITY_NAME, FACILITY_TYPE, ADDRESS, PHONE, LATITUDE, LONGITUDE, OPEN_TIME, HOMEPAGE, REGION_CODE, MANAGE_AGENCY)
VALUES ('F005', '부산시립미술관', '미술관', '부산광역시 해운대구 APEC로 58', '051-744-2602', 35.1632100, 129.1313200, '10:00-18:00 (월요일 휴관)', 'https://art.busan.go.kr', '26', '부산광역시');

INSERT INTO TB_CULTURE_FACILITY (FACILITY_ID, FACILITY_NAME, FACILITY_TYPE, ADDRESS, PHONE, LATITUDE, LONGITUDE, OPEN_TIME, HOMEPAGE, REGION_CODE, MANAGE_AGENCY)
VALUES ('F006', '부산박물관', '박물관', '부산광역시 남구 유엔평화로 63', '051-610-7111', 35.1362300, 129.0851200, '09:00-18:00 (월요일 휴관)', 'https://museum.busan.go.kr', '26', '부산광역시');

INSERT INTO TB_CULTURE_FACILITY (FACILITY_ID, FACILITY_NAME, FACILITY_TYPE, ADDRESS, PHONE, LATITUDE, LONGITUDE, OPEN_TIME, HOMEPAGE, REGION_CODE, MANAGE_AGENCY)
VALUES ('F007', '경기도박물관', '박물관', '경기도 용인시 기흥구 상갈로 6', '031-288-5300', 37.2741100, 127.1134500, '10:00-18:00 (월요일 휴관)', 'https://museum.ggcf.kr', '41', '경기도');

INSERT INTO TB_CULTURE_FACILITY (FACILITY_ID, FACILITY_NAME, FACILITY_TYPE, ADDRESS, PHONE, LATITUDE, LONGITUDE, OPEN_TIME, HOMEPAGE, REGION_CODE, MANAGE_AGENCY)
VALUES ('F008', '경기도미술관', '미술관', '경기도 안산시 단원구 동산로 268', '031-481-7000', 37.3125600, 126.8215400, '10:00-18:00 (월요일 휴관)', 'https://www.gmoma.ggcf.kr', '41', '경기도');

-- 테스트용 서비스키
INSERT INTO TN_PUBC_USER_CRTFC (
    SERVICE_KEY, SERVICE_ID, INST_CD, IP_ADRES,
    USE_BEGIN_DT, USE_END_DT, USE_STTS, REGIST_DT
) VALUES (
    'test123',
    'TEST_USER_API',
    'TEST_INST',
    '127.0.0.1,localhost',
    '20250101',
    '20991231',
    'Y',
    '20250103140000'
);

INSERT INTO TN_PUBC_USER_CRTFC (
    SERVICE_KEY, SERVICE_ID, INST_CD, IP_ADRES,
    USE_BEGIN_DT, USE_END_DT, USE_STTS, REGIST_DT
) VALUES (
    'devkey456',
    'DEV_USER_API',
    'DEV_INST',
    '',  -- IP 제한 없음
    '20250101',
    '20251231',
    'Y',
    '20250103140000'
);

COMMIT;
```

---

## 8. 데이터베이스 마이그레이션 전략

### 8.1 버전 관리

스키마 변경은 버전별로 관리합니다:

```
db/migration/
├── V1.0__initial_schema.sql         # 초기 스키마
├── V1.1__add_user_status.sql        # 사용자 상태 컬럼 추가
├── V1.2__add_user_indexes.sql       # 인덱스 추가
└── V2.0__refactor_user_table.sql    # 테이블 구조 변경
```

### 8.2 롤백 스크립트

각 마이그레이션마다 롤백 스크립트 작성:

```sql
-- V1.1__add_user_status.sql (업그레이드)
ALTER TABLE TB_USER ADD COLUMN USER_STATUS VARCHAR(10) DEFAULT 'ACTIVE';

-- R1.1__rollback_user_status.sql (롤백)
ALTER TABLE TB_USER DROP COLUMN USER_STATUS;
```

---

## 9. 성능 최적화

### 9.1 파티셔닝 전략 (대용량 데이터)

**TN_PUBC_USE_STTUS_INFO** 테이블은 로그 데이터로 급격히 증가하므로 파티셔닝 권장:

```sql
-- Oracle 월별 파티셔닝 예시
CREATE TABLE TN_PUBC_USE_STTUS_INFO (
    -- 컬럼 정의...
)
PARTITION BY RANGE (REQUEST_TIME)
INTERVAL (NUMTOYMINTERVAL(1, 'MONTH')) (
    PARTITION P_202501 VALUES LESS THAN (TO_DATE('2025-02-01', 'YYYY-MM-DD'))
);
```

### 9.2 아카이빙 정책

```sql
-- 3개월 이상 된 로그 데이터 아카이브 테이블로 이동
CREATE TABLE TN_PUBC_USE_STTUS_ARCHIVE AS
SELECT * FROM TN_PUBC_USE_STTUS_INFO WHERE 1=0;

-- 월별 아카이빙 배치
INSERT INTO TN_PUBC_USE_STTUS_ARCHIVE
SELECT * FROM TN_PUBC_USE_STTUS_INFO
WHERE REQUEST_TIME < ADD_MONTHS(SYSDATE, -3);

DELETE FROM TN_PUBC_USE_STTUS_INFO
WHERE REQUEST_TIME < ADD_MONTHS(SYSDATE, -3);

COMMIT;
```

---

## 10. 보안 고려사항

### 10.1 민감 데이터 암호화

- **이메일 주소**: 필요 시 암호화 저장 (AES-256)
- **서비스키**: 해시 저장 권장 (SHA-256)

### 10.2 접근 권한

```sql
-- 읽기 전용 사용자 (통계 조회용)
CREATE USER readonly_user IDENTIFIED BY password;
GRANT SELECT ON TB_USER TO readonly_user;
GRANT SELECT ON TN_PUBC_USE_STTUS_INFO TO readonly_user;

-- 애플리케이션 사용자 (CRUD)
CREATE USER app_user IDENTIFIED BY password;
GRANT SELECT, INSERT, UPDATE, DELETE ON TB_USER TO app_user;
GRANT SELECT, INSERT ON TN_PUBC_USE_STTUS_INFO TO app_user;
```

---

## 부록 A: 통계 쿼리 예시

### A.1 일별 API 호출 통계

```sql
SELECT
    TO_CHAR(REQUEST_TIME, 'YYYY-MM-DD') AS REQUEST_DATE,
    SERVICE_KEY,
    COUNT(*) AS TOTAL_CALLS,
    SUM(CASE WHEN TROBL_TY_CODE = '00' THEN 1 ELSE 0 END) AS SUCCESS_CALLS,
    SUM(CASE WHEN TROBL_TY_CODE != '00' THEN 1 ELSE 0 END) AS FAIL_CALLS,
    ROUND(AVG(PROCESS_TIME), 2) AS AVG_PROCESS_TIME_MS
FROM TN_PUBC_USE_STTUS_INFO
WHERE REQUEST_TIME >= TRUNC(SYSDATE) - 7  -- 최근 7일
GROUP BY TO_CHAR(REQUEST_TIME, 'YYYY-MM-DD'), SERVICE_KEY
ORDER BY REQUEST_DATE DESC, TOTAL_CALLS DESC;
```

### A.2 에러 유형별 통계

```sql
SELECT
    TROBL_TY_CODE,
    COUNT(*) AS ERROR_COUNT,
    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (), 2) AS ERROR_RATE_PCT
FROM TN_PUBC_USE_STTUS_INFO
WHERE TROBL_TY_CODE != '00'
  AND REQUEST_TIME >= TRUNC(SYSDATE)  -- 오늘
GROUP BY TROBL_TY_CODE
ORDER BY ERROR_COUNT DESC;
```

### A.3 시간대별 트래픽 분석

```sql
SELECT
    TO_CHAR(REQUEST_TIME, 'HH24') AS HOUR_OF_DAY,
    COUNT(*) AS REQUEST_COUNT,
    ROUND(AVG(PROCESS_TIME), 2) AS AVG_RESPONSE_TIME
FROM TN_PUBC_USE_STTUS_INFO
WHERE REQUEST_TIME >= TRUNC(SYSDATE)
GROUP BY TO_CHAR(REQUEST_TIME, 'HH24')
ORDER BY HOUR_OF_DAY;
```

---

**작성자**: Claude
**버전**: 1.0
**최종 수정일**: 2025-11-03
